ANPR City API - Project Structure
==================================

anpr-city-api/
â”‚
â”œâ”€â”€ ğŸ“„ Configuration Files
â”‚   â”œâ”€â”€ .env.example                 # Environment variables template
â”‚   â”œâ”€â”€ .gitignore                   # Git ignore rules
â”‚   â”œâ”€â”€ .dockerignore                # Docker build ignore rules
â”‚   â”œâ”€â”€ requirements.txt             # Python dependencies
â”‚   â”œâ”€â”€ pyproject.toml              # Python project config (ruff, black, mypy)
â”‚   â”œâ”€â”€ package.json                # NPM scripts for convenience
â”‚   â”œâ”€â”€ Makefile                    # Common development commands
â”‚   â””â”€â”€ alembic.ini                 # Alembic migration config
â”‚
â”œâ”€â”€ ğŸ³ Docker & Deployment
â”‚   â”œâ”€â”€ Dockerfile                   # Container image definition
â”‚   â”œâ”€â”€ docker-compose.yml          # Self-hosted mode stack
â”‚   â””â”€â”€ docker-compose.supabase.yml # Supabase mode stack
â”‚
â”œâ”€â”€ ğŸ”„ CI/CD
â”‚   â””â”€â”€ .github/
â”‚       â””â”€â”€ workflows/
â”‚           â””â”€â”€ ci.yml              # GitHub Actions pipeline
â”‚
â”œâ”€â”€ ğŸ’¾ Database
â”‚   â”œâ”€â”€ alembic/                    # Alembic migration tool
â”‚   â”‚   â”œâ”€â”€ env.py                  # Migration environment
â”‚   â”‚   â””â”€â”€ script.py.mako         # Migration template
â”‚   â””â”€â”€ migrations/                 # SQL migrations
â”‚       â””â”€â”€ 001_initial_schema.sql  # Initial database schema
â”‚
â”œâ”€â”€ ğŸ Source Code
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ main.py                 # FastAPI application entrypoint
â”‚       â”œâ”€â”€ worker.py               # Background job processor
â”‚       â”œâ”€â”€ config.py               # Settings management
â”‚       â”œâ”€â”€ database.py             # Database connection & session
â”‚       â”œâ”€â”€ auth.py                 # JWT authentication logic
â”‚       â”œâ”€â”€ logging_config.py       # Structured logging setup
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“Š models/              # SQLAlchemy ORM Models
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ user.py             # Users & roles
â”‚       â”‚   â”œâ”€â”€ camera.py           # Camera registry
â”‚       â”‚   â”œâ”€â”€ upload.py           # Video uploads & jobs
â”‚       â”‚   â”œâ”€â”€ event.py            # Detection events & corrections
â”‚       â”‚   â”œâ”€â”€ bolo.py             # BOLO alerts & matches
â”‚       â”‚   â”œâ”€â”€ license.py          # License keys & usage
â”‚       â”‚   â”œâ”€â”€ export.py           # Data export jobs
â”‚       â”‚   â””â”€â”€ audit.py            # Audit logs
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“‹ schemas/             # Pydantic Request/Response Schemas
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ auth.py             # Login, token schemas
â”‚       â”‚   â”œâ”€â”€ user.py             # User create/response
â”‚       â”‚   â”œâ”€â”€ camera.py           # Camera CRUD schemas
â”‚       â”‚   â”œâ”€â”€ upload.py           # Upload job response
â”‚       â”‚   â”œâ”€â”€ event.py            # Event search/response
â”‚       â”‚   â”œâ”€â”€ correction.py       # Correction create/response
â”‚       â”‚   â”œâ”€â”€ bolo.py             # BOLO create/response
â”‚       â”‚   â””â”€â”€ license.py          # License activation schemas
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ›£ï¸  api/                 # API Route Handlers
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ auth.py             # POST /auth/login
â”‚       â”‚   â”œâ”€â”€ users.py            # User management (admin)
â”‚       â”‚   â”œâ”€â”€ cameras.py          # Camera CRUD
â”‚       â”‚   â”œâ”€â”€ uploads.py          # Video upload
â”‚       â”‚   â”œâ”€â”€ jobs.py             # Job status queries
â”‚       â”‚   â”œâ”€â”€ events.py           # Event search & details
â”‚       â”‚   â”œâ”€â”€ feedback.py         # Review workflow & export
â”‚       â”‚   â”œâ”€â”€ bolos.py            # BOLO management
â”‚       â”‚   â”œâ”€â”€ licenses.py         # License activation
â”‚       â”‚   â””â”€â”€ admin.py            # Admin endpoints (health)
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ”§ services/            # Business Logic Services
â”‚       â”‚   â”œâ”€â”€ storage.py          # Storage abstraction (S3/MinIO/Supabase)
â”‚       â”‚   â”œâ”€â”€ queue.py            # Redis queue service
â”‚       â”‚   â””â”€â”€ detector_adapter.py # Video processing orchestrator
â”‚       â”‚
â”‚       â””â”€â”€ ğŸ¤– detectors/           # ML Detection Adapters
â”‚           â””â”€â”€ yolo_easyocr_adapter.py  # âš ï¸  STUB - Needs real implementation
â”‚
â”œâ”€â”€ ğŸ§ª Tests
â”‚   â””â”€â”€ tests/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ conftest.py             # Test fixtures & configuration
â”‚       â”œâ”€â”€ test_auth.py            # Authentication tests
â”‚       â”œâ”€â”€ test_cameras.py         # Camera API tests
â”‚       â””â”€â”€ test_events.py          # Event API tests
â”‚
â”œâ”€â”€ ğŸ“œ Scripts
â”‚   â””â”€â”€ scripts/
â”‚       â”œâ”€â”€ bootstrap.sh            # Initial setup script
â”‚       â””â”€â”€ test-api.sh             # API smoke test script
â”‚
â””â”€â”€ ğŸ“š Documentation
    â”œâ”€â”€ README.md                   # Main documentation & setup guide
    â”œâ”€â”€ PROJECT_SUMMARY.md          # This file - project overview
    â”œâ”€â”€ PROJECT_STRUCTURE.txt       # Project file tree (this file)
    â”œâ”€â”€ DEVELOPER_HANDOFF.md        # Technical guide for developers
    â”œâ”€â”€ DEVELOPMENT_CHECKLIST.md    # TODO list & roadmap
    â”œâ”€â”€ API_QUICK_REFERENCE.md      # API usage examples
    â”œâ”€â”€ SUPABASE_SETUP.md           # Supabase configuration guide
    â””â”€â”€ OPERATIONAL_CONSIDERATIONS.md # Production operations guide

Key Components:
===============

1. API Server (src/main.py)
   - FastAPI application
   - REST API with OpenAPI docs
   - JWT authentication
   - CORS middleware
   - Prometheus metrics

2. Worker (src/worker.py)
   - Background job processor
   - Pulls jobs from Redis queue
   - Downloads videos from storage
   - Runs detector on frames
   - Saves events to database
   - Checks BOLO matches
   - Sends notifications

3. Database (PostgreSQL)
   - 11 tables (users, cameras, uploads, events, etc.)
   - SQLAlchemy async ORM
   - Alembic migrations
   - Comprehensive indexes

4. Storage (S3/MinIO/Supabase)
   - Raw video uploads
   - Crop images from detections
   - Presigned URL generation
   - Two buckets: anpr-uploads, anpr-crops

5. Queue (Redis)
   - Job queue for video processing
   - Simple FIFO queue
   - Worker pulls jobs with BRPOP

6. Detector (STUB)
   - Currently returns mock data
   - Needs YOLO + EasyOCR integration
   - See src/detectors/yolo_easyocr_adapter.py

Dependencies:
=============

Core:
- fastapi==0.109.0
- sqlalchemy[asyncio]==2.0.25
- asyncpg==0.29.0
- redis==5.0.1
- pydantic==2.5.3

Auth:
- python-jose[cryptography]==3.3.0
- passlib[bcrypt]==1.7.4

Storage:
- boto3==1.34.34
- minio==7.2.3
- supabase==2.3.4

Processing:
- opencv-python-headless==4.9.0.80
- ffmpeg-python==0.2.0

Monitoring:
- prometheus-client==0.19.0
- structlog==24.1.0

Testing:
- pytest==7.4.4
- pytest-asyncio==0.23.3
- httpx==0.26.0

Statistics:
===========

Total Files: 65+
Source Files: 45 Python files
Documentation: 8 markdown files
Configuration: 12 config files
Lines of Code: ~5,000 lines

API Endpoints: 20+
Database Tables: 11
Test Files: 5

Docker Images: 1
Docker Compose Configs: 2
CI/CD Pipelines: 1

Code Coverage: ~40% (needs improvement)

Status: âœ… Core implementation complete, ready for detector integration
